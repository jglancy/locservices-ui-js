define(["jquery","locservices/ui/component/component"],function(a,b){function c(b){var c=this;if(b=b||{},b.componentId="autocomplete",this._waitingForResults=!1,this._timeoutId=null,this._highlightedSearchResultIndex=null,"object"!=typeof b.api)throw new Error("AutoComplete requires an api option");if(this._api=b.api,!b.element instanceof a)throw new Error("AutoComplete requires an element option");if(this.input=b.element,this.input.attr("autocomplete","off"),!b.api)throw new Error("AutoComplete requires an api option");this.setComponentOptions(b),this.on("results",function(a,b){c.renderSearchResults(a,b)}),a(document).on("keydown",function(a){switch(a.keyCode){case d.escape:c.escapeKeyHandler();break;case d.enter:c.enterKeyHandler(a);break;case d.upArrow:a.preventDefault(),c.highlightPrevSearchResult();break;case d.downArrow:c.highlightNextSearchResult();break;default:c.autoComplete()}})}var d={enter:13,escape:27,upArrow:38,downArrow:40},e=2,f=500;return c.prototype=new b,c.prototype.constructor=c,c.prototype.prepareSearchTerm=function(a){return String(a).replace(/^\s\s*/,"").replace(/\s\s*$/,"")},c.prototype.isValidSearchTerm=function(a){var b,c;return"string"!=typeof a?!1:(b=this.prepareSearchTerm(a),c=b.length>=e)},c.prototype.autoComplete=function(){var a=this.prepareSearchTerm(this.input.val()),b=this;this._waitingForResults||!this.isValidSearchTerm(a)||a.length<=e||(clearTimeout(this._timeoutId),this._timeoutId=setTimeout(function(){b._waitingForResults=!0,b._api.autoComplete(a,{success:function(a){b._waitingForResults=!1,b.emit("results",[a.results,a.metadata])},error:function(){b.emit("error",[{code:"autocomplete.error.search",message:"There was a problem searching for the search term"}])}})},f))},c.prototype.clearSearchResults=function(){this.searchResultsData=null,this._highlightedSearchResultIndex=null,this.searchResults&&(this.searchResults.remove(),this.searchResults=null)},c.prototype.renderSearchResults=function(b){var c,d,e,f="",g="",h={};if(c=this,this.searchResultsData=b,e=b.length,0===e)return void this.clearSearchResults();for(this.searchResults||(this.container.append('<ul class="ls-ui-autocomplete-results" />'),this.searchResults=this.container.find(".ls-ui-autocomplete-results"),this.searchResults.on("mouseover","li",function(){c.highlightSearchResultByIndex(a(this).index(),!1)}).on("mouseout","li",function(){a(this).removeClass("active")}),this.positionSearchResults()),d=0;e>d;d++)h=b[d],g=h.name,h.container&&(g+=", "+h.container),f+='<li><a href="#" data-location="'+h.id+'">'+g+"</a></li>";this.searchResults.html(f)},c.prototype.positionSearchResults=function(){var a=this.input.offset();this.searchResults.css({left:parseInt(a.left,0),top:parseInt(a.top,0)+this.input.outerHeight(),width:parseInt(this.input.outerWidth(),0)})},c.prototype.escapeKeyHandler=function(){null!==this._highlightedSearchResultIndex&&this.input.val(this.currentSearchTerm),this.clearSearchResults()},c.prototype.enterKeyHandler=function(a){if(null!==this._highlightedSearchResultIndex){a.preventDefault();var b=this.searchResultsData[this._highlightedSearchResultIndex];this.emit("location",[b])}this.clearSearchResults()},c.prototype.highlightNextSearchResult=function(){var a=this._highlightedSearchResultIndex;if(null===a)a=0;else if(a++,this.searchResultsData.length<=a)return void this.removeSearchResultHighlight(!0);this.highlightSearchResultByIndex(a,!0)},c.prototype.highlightPrevSearchResult=function(){var a;if(a=this._highlightedSearchResultIndex,null===a)a=this.searchResultsData.length-1;else if(a--,0>a)return void this.removeSearchResultHighlight(!0);this.highlightSearchResultByIndex(a,!0)},c.prototype.clearResults=function(){this.container.html("")},c.prototype.highlightSearchResultByIndex=function(b,c){var d=this.searchResultsData[b],e=d.name;d.container&&(e+=", "+d.container),this.removeSearchResultHighlight(),this._highlightedSearchResultIndex=b,a(this.searchResults.find("li")[b]).addClass("active"),c&&this.input.val(e)},c.prototype.removeSearchResultHighlight=function(a){this._highlightedSearchResultIndex=null,this.searchResults.find("li.active").removeClass("active"),a&&this.input.val(this.currentSearchTerm)},c});